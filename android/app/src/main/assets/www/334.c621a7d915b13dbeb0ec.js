"use strict";(self.webpackChunksosgame=self.webpackChunksosgame||[]).push([[334],{510:(e,n,t)=>{t.d(n,{A:()=>r});const r=function(e){return{message:e.onMessage}}},940:(e,n,t)=>{t.d(n,{A:()=>i});var r=t(746);function o(){}function i(e,n){const t=(0,r.A)(["close","disconnect","error","join","gameinit","reconnect"]);let i={},s=null;return{connect:function(c){return new Promise(((a,l)=>{c||l("Can't determine ws address");const d=function(e,n,t){const i=(0,r.A)(["error","open","message","beforeclose","close"]),s=new WebSocket(n);function c(e){t.log("Websocket message received: "+e);const n=JSON.parse(e);return i.call("message",n)}return s.onopen=function(){return i.call("open",e)},s.onclose=function(n){return t.log("Websocket closed "+n.code+" "+n.reason),i.call("close",e)},s.onmessage=function(e){if(e.data instanceof Blob){const n=new FileReader;return n.onload=()=>c(n.result),n.readAsText(e.data)}return c(e.data)},s.onerror=function(n){return t.error(n),i.call("error",e)},{on:(e,n)=>i.on(e,n),send:(n,r,o,i)=>{const c={from:e,to:o,action:n,data:r,ignore:i};return t.log("Sending ["+e+"] to ["+o+"]: "+JSON.stringify(r)),s.send(JSON.stringify(c))},close:async()=>(await i.call("beforeclose",e),s.onerror=o,s.close())}}(e,c,n);d.on("message",(function(r){if(r.from!==e)if(r.to===e||"all"==r.to){if(!(r.ignore&&Array.isArray(r.ignore)&&r.ignore.includes(e)))return t.actionKeys().includes(r.action)?(n.log("handlers.actionKeys"),t.call(r.action,r)):Object.keys(i).includes(r.action)?(n.log("callCurrentHandler"),function(e,t){const r=i[e];"function"==typeof r?null!=s?s.add((()=>r(t.data,t.from))):n.log("No queue"):n.log("Not function")}(r.action,r)):void n.log("Unknown action "+r.action);n.log("user in ignore list")}else n.log("another user");else n.error("same user")}));const u=(e,t,r)=>(n.log(t),d.send(e,t,"all",r)),g=(e,n,t)=>d.send(e,n,t);d.on("open",(()=>a({sendRawAll:u,sendRawTo:g})))}))},on:function(e,n){return t.on(e,n)},getWebSocketUrl:function(e,n){return e.wh?e.wh:"https:"===n.protocol?null:"ws://"+n.hostname+":"+e.wsPort},registerHandler:function(e,n){s=n,i=e}}}},334:(e,n,t)=>{t.r(n),t.d(n,{default:()=>l});var r=t(267),o=t(940),i=t(373),s=t(510),c=t(233),a=t(379);function l(e,n,t,l){return new Promise(((d,u)=>{const g=r.A.getMyId(e,t,Math.random),f=r.A.setupLogger(n,t),I=(0,o.A)(g,f),m=(0,c.A)(f);I.connect(I.getWebSocketUrl(t,e.location)).then((r=>{f.log("connected"),I.on("gameinit",(o=>{const c=i.A.presenterFunc(o.data.presenter,t),a=l(e,n,t,c),u=(0,s.A)(a);I.registerHandler(u,m),function(e,n,t,r){for(const o of e.actionKeys())e.on(o,(e=>{!e||null!==e.playerId&&e.playerId!==r.joinedInd?t.log("ignore"):n.sendRawTo(o,e,r.serverId)}))}(a,r,f,o.data),d(a)})),I.on("reconnect",(n=>{(0,a.vA)(n.data.serverId===n.from,`Different server ${n}`),e.location.reload()})),r.sendRawAll("join")})).catch((e=>{f.error(e),u(e)}))}))}},267:(e,n,t)=>{t.d(n,{A:()=>i});var r=t(379);const o={makeId:function(e,n){let t="";const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let o=0;o<e;o++)t+=r.charAt(Math.floor(62*n()));return t}};const i={setupLogger:function(e,n){return function(e,n){return{log:t=>{if(n.networkDebug)return(0,r.Rm)(t,e)},error:n=>{if(e)return(0,r.z3)(n,e)}}}(n.logger?e.querySelector(n.logger):null,n)},getMyId:function(e,n,t){const r=e.sessionStorage.getItem(n.idNameInStorage);if(r)return r;const i=o.makeId(n.idNameLen,t);e.sessionStorage.setItem(n.idNameInStorage,i)},setupMedia:function(){if(navigator.mediaDevices)return navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}}},373:(e,n,t)=>{t.d(n,{A:()=>a});var r=t(189),o=t(746);function i(e,n,t,r,o){let i=t,s="";return o>=0&&o<r.length&&(s=r[o]),{isLastMove:e,isActive:n,text:i,color:s}}function s(e){return{clientUserIdx:e.colorOrder.indexOf(e.color),currentUserIdx:0,playersSize:e.playerLimit,activeCellIndex:-1,activeDigitIndex:-1,lastMove:-1,gameover:!0,gamestarted:!1,round:0,fieldArr:r.A.init(e.size),movesIdx:Array(e.size).fill(-1)}}function c({currentUserIdx:e,clientUserIdx:n,playersSize:t,activeCellIndex:s,activeDigitIndex:c,lastMove:a,gameover:l,gamestarted:d,round:u,fieldArr:g,movesIdx:f},I){let m=r.A.field(g);const A=(0,o.A)(["firstmove","gameover"]);const v=()=>{e=(e+1)%t},p=function(t,o,i){if(!((e,n,t,r)=>!(n<0||n>=2)&&t==r&&m.canSet(e))(t,o,i,e))return{res:r.A.IMPOSSIBLE_MOVE,position:-1,digit:-1,playerId:e,clientId:i};const u=m.setSafeByIndex(o,t);if(u===r.A.IMPOSSIBLE_MOVE)return{res:u,position:-1,digit:-1,playerId:e,clientId:i};s=-1,c=-1,d||A.call("firstmove",{}),d=!0,f[t]=i,a=t;const g=e,I=n;return u===r.A.NORMAL_MOVE&&v(),u!==r.A.WINNING_MOVE&&u!==r.A.DRAW_MOVE||(l=!0,A.call("gameover",u)),{res:u,position:t,digit:o,playerId:g,clientId:I}},y=m.size,M=()=>I.colorOrder[e],S=()=>{d=!1,l=!1,s=-1,c=-1,a=-1,g=r.A.init(y()),f=Array(y()).fill(-1),e=u%t,m=r.A.field(g)};return{on:function(e,n){return A.on(e,n)},size:y,tryMove:function(){return p(s,c,e)},setMove:p,enum1:()=>function*(){for(let e=0;e<m.size();++e)yield[e,i(a===e,s===e,m.getCharSafe(e),I.colorOrder,f[e])]}(),setActivePosition:function(t){n!==e||l||(s=m.canSet(t)?t:-1)},setActiveDigitIndex:function(t){n!==e||l||(c=t)},currentColor:M,getActiveDigitIndex:()=>c,endMessage:t=>t===r.A.DRAW_MOVE?"Draw":e!==n?"You lose":"You win",endMessage2:e=>e===r.A.DRAW_MOVE?"Draw":M()+" player win",toJson:n=>({currentUserIdx:e,clientUserIdx:n,playersSize:t,activeCellIndex:s,activeDigitIndex:c,lastMove:a,gameover:l,fieldArr:m.toArr(),movesIdx:f}),isGameOver:()=>l,isMyMove:()=>!l&&e===n,calcLastMoveRes:()=>{if(a<0)return r.A.IMPOSSIBLE_MOVE;return m.checkWinning(a)},getCurrentIndex:()=>e,setClientIndex:e=>{n=e},getClientIndex:()=>n,getPlayersSize:()=>t,setMyTurn:()=>{e=n},nextRound:()=>{++u,S()},resetRound:S}}const a={presenterFunc:c,defaultPresenter:s,presenterFuncDefault:function(e){return c(s(e),e)}}},233:(e,n,t)=>{function r(e){let n=Promise.resolve();return{add:t=>new Promise(((r,o)=>{n=n.then(t).then(r).catch((n=>{e.log(n),o(n)}))}))}}t.d(n,{A:()=>r})}}]);