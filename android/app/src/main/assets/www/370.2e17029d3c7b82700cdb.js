"use strict";(self.webpackChunksosgame=self.webpackChunksosgame||[]).push([[370],{189:(e,t,n)=>{n.d(t,{A:()=>u});const r=-1,i=1,o=2,s=3;function c(e){switch(e){case 5:return"S";case 2:return"O";case 0:return" "}return""}function d(e){return Array.from({length:e}).fill(0)}function l(e){const t=[5,2],n=[-1,-1,...e,-1,-1],d=n.length-4,u=e=>e>=0&&e<d,a=e=>{for(let t=e+2;t<e+5;++t){if(5===n[t-2]&&2===n[t-1]&&5===n[t])return s}for(let e=0;e<d;e++)if(0===n[e+2])return i;return o},f=e=>0===n[2+e],I=e=>u(e)&&f(e),A=()=>n.slice(2,-2);return{size:()=>d,setSafe:(e,t)=>I(t)?(((e,t)=>{n[2+t]=function(e){switch(e){case"S":case"s":return 5;case"O":case"o":return 2;case" ":return 0;case"":return-1}return-1}(e)})(e,t),a(t)):r,setSafeByIndex:(e,i,o=!1)=>{if(!I(i))return r;if(e<0||e>=t.length)return r;const s=n[2+i];n[2+i]=t[e];const c=a(i);return o&&(n[2+i]=s),c},getCharSafe:e=>u(e)?(e=>c(n[2+e]))(e):"",canSet:I,clone:()=>l(e),movesLeft:()=>n.reduce(((e,t)=>e+(0===t)),0),toArr:A,asString:()=>A().map(c).join(""),isEmpty:f,inBounds:u,checkWinning:a}}const u={defaultField:function(e){return l(d(e))},field:l,init:d,IMPOSSIBLE_MOVE:r,NORMAL_MOVE:i,WINNING_MOVE:s,DRAW_MOVE:o}},657:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(379);function i(e,t=0){const n=[];for(const[t]of Object.entries(e))n.push(t);let i=n.length;const o=t=>{const i=n[t];(0,r.vA)(i,"Bad Index");const o=e[i];return(0,r.vA)(o,"Empty client"),o},s=t=>{const n=e[t];return(0,r.vA)(n,`No id ${t} in clients`),n},c=(e,t)=>{const r=e.index,i=n[r];n[e.index]=n[t.index],e.index=t.index,n[t.index]=i,t.index=r},d=e=>(e+n.length)%n.length;return{addClient:(t,o)=>{const s=e[t];s?s.name=o:(e[t]={index:i,name:o},n.push(t),++i),(0,r.vA)(i===n.length)},remove:t=>{const o=e[t];--i;const s=n[i];n[o.index]=s,n.pop();e[s].index=o.index,e[t]=void 0,(0,r.vA)(i===n.length)},swapInd:(e,t)=>{const n=o(e),r=o(t);c(n,r)},swapById:(e,t)=>{const n=s(e),r=s(t);c(n,r)},indById:e=>d(s(e).index+t),idByInd:e=>n[d(e-t)],size:()=>n.length}}},370:(e,t,n)=>{n.r(t),n.d(t,{default:()=>m});var r=n(379),i=n(189),o=n(272);const s={bestMove:function(e,t=0,n=void 0){let r=i.A.IMPOSSIBLE_MOVE,o={res:r,digit:-1,position:-1};const s=n||e.size();for(let n=Math.max(t,0);n<Math.min(s,e.size());++n)for(let t=0;t<2;++t){const s=e.setSafeByIndex(t,n,!0);if(s===i.A.IMPOSSIBLE_MOVE)break;if(s===i.A.WINNING_MOVE)return{res:s,digit:t,position:n};r<s&&(r=s,o={res:r,digit:t,position:n})}return o}};const c={bestMove:function(e){const t=[],n=[];for(let r=0;r<e.size();++r)for(let o=0;o<2;++o){const c=e.clone(),d=c.setSafeByIndex(o,r);if(d===i.A.IMPOSSIBLE_MOVE)break;if(d===i.A.WINNING_MOVE)return{res:d,digit:o,position:r};s.bestMove(c,r-2,r+3).res===i.A.WINNING_MOVE?n.push({res:d,digit:o,position:r}):t.push({res:d,digit:o,position:r})}return t.length>0?o.A.randomEl(t):n.length>0?o.A.randomEl(n):void(0,r.vA)(!1,"No moves")}},d=4,l=5;function u(e,t,n){const o=[],c=n.asString();let l=c.indexOf(e);for(;-1!==l;){const u=0,a=l+t,f=n.clone(),I=f.setSafeByIndex(u,a);(0,r.vA)(I===i.A.NORMAL_MOVE,a);s.bestMove(f,a-2,a+3).res!==i.A.WINNING_MOVE&&o.push({res:d,digit:u,position:a}),l=c.indexOf(e,a+1)}return o}function a(e){const t=[],n=" "+e.asString()+" ",r=" ".repeat(9);let i=n.indexOf(r);for(;-1!==i;){const e=0,o=i+4-1,s=l;t.push({res:s,digit:e,position:o}),i=n.indexOf(r,i+1)}return t}function f(e){(0,r.vA)(e.movesLeft()%2==1);const t=function(e){const t=[];return t.push(...u("   S",0,e)),t.push(...u("S   ",3,e)),t}(e);if(t.length>0)return o.A.randomEl(t);const n=a(e);return n.length>0?o.A.randomEl(n):c.bestMove(e)}function I(e){const t=e.toArr();let n=[],i=0,o=0,s=-1,c=-1;for(let e=0;e<t.length;e++){0===t[e]?(0===i&&(s=e),++i,c=e+1,i>o?(o=i,(0,r.vA)(o===c-s),n=o%2==0?[s+o/2-1,s+o/2]:[(o-1)/2+s]):i===o&&((0,r.vA)(o===c-s),o%2==0?(n.push(o/2+s-1),n.push(s+o/2)):n.push((o-1)/2+s))):(i=0,c=-1,s=-1)}return n}function A(e){(0,r.vA)(e.movesLeft()%2==0);const t=e.asString();let n=t.indexOf("S  S");return n>=0?c.bestMove(e):(n=t.indexOf("   "),n<0?c.bestMove(e):function(e){const t=[],n=[],c=[],u=[];for(let o=0;o<e.size();++o)for(let a=1;a<2;++a){const I=e.clone(),A=I.setSafeByIndex(a,o);if(A===i.A.IMPOSSIBLE_MOVE)break;A===i.A.WINNING_MOVE&&(0,r.vA)(!1,"Bad state");if(s.bestMove(I,o-2,o+3).res===i.A.WINNING_MOVE)n.push({res:A,digit:a,position:o});else{const e=f(I);e.res===d?c.push({res:A,digit:a,position:o}):e.res===l?u.push({res:A,digit:a,position:o}):t.push({res:A,digit:a,position:o})}}if(t.length>0)return o.A.randomEl(t);if(u.length>0)return o.A.randomEl(u);if(c.length>0)return o.A.randomEl(c);if(n.length>0)return o.A.randomEl(n);(0,r.vA)(!1,"No moves")}(e))}const g={bestMove:function(e){const t=s.bestMove(e);if(t.res===i.A.WINNING_MOVE)return t;if(e.movesLeft()%2==1){const t=f(e);return t.res>i.A.DRAW_MOVE&&(t.res=i.A.NORMAL_MOVE),t}return A(e)},findPattern:u,findLongEmpty:a,longestEmptyMids:I,randomEmptyMid:function(e){o.A.randomEl(I(e))},SOOS_MOVE:d,FIRST_S_MOVE:l};var v=n(657),M=n(373);function p(e,t){const n=e.getCurrentIndex();if(n===e.getClientIndex())return;const o=e.toJson(n);(0,r.vA)(o.currentUserIdx===n,"Corrupt data");const s=g.bestMove(i.A.field(o.fieldArr));return s.playerId=n,t.onMessage(s)}function m(e,t,n,i){return new Promise((o=>{const s=M.A.presenterFuncDefault(n),c=i(e,t,n,s),d=s.getClientIndex(),l=(0,v.A)({},d);l.addClient("user","user");for(let e=1;e<s.getPlayersSize();++e){const t="bot"+e;l.addClient(t,t)}c.on("gameover",(()=>{t.querySelector(".butInstall").classList.remove("hidden2")})),c.on("message",(async e=>{e.playerId===d&&(await(0,r.cb)(100),await p(s,c))})),c.on("winclosed",(()=>{s.nextRound(),c.redraw(),p(s,c)})),s.resetRound(),p(s,c),c.redraw(),o(c)}))}},373:(e,t,n)=>{n.d(t,{A:()=>d});var r=n(189),i=n(746);function o(e,t,n,r,i){const o=n;let s="";return i>=0&&i<r.length&&(s=r[i]),{isLastMove:e,isActive:t,text:o,color:s}}function s(e){return{clientUserIdx:e.colorOrder.indexOf(e.color),currentUserIdx:0,playersSize:e.playerLimit,activeCellIndex:-1,activeDigitIndex:-1,lastMove:-1,gameover:!0,round:0,moveCount:0,fieldArr:r.A.init(e.size),movesIdx:Array.from({length:e.size}).fill(-1)}}function c({currentUserIdx:e,clientUserIdx:t,playersSize:n,activeCellIndex:s,activeDigitIndex:c,lastMove:d,gameover:l,round:u,moveCount:a,fieldArr:f,movesIdx:I},A){let g=r.A.field(f);const v=(0,i.A)(["moveEnd","nextPlayer","gameover"]);const M=()=>{e=(e+1)%n},p=async function(n,i,o){if(!((e,t,n,r)=>!(t<0||t>=2)&&n===r&&g.canSet(e))(n,i,o,e))return{res:r.A.IMPOSSIBLE_MOVE,position:-1,digit:-1,playerId:e,clientId:o};const u=g.setSafeByIndex(i,n);if(u===r.A.IMPOSSIBLE_MOVE)return{res:u,position:-1,digit:-1,playerId:e,clientId:o};s=-1,c=-1,I[n]=o,d=n,++a;const f=e,A=t;return await v.call("moveEnd",{res:u,position:n,digit:i,playerId:f,clientId:A,moveCount:a}),u===r.A.NORMAL_MOVE&&(M(),await v.call("nextPlayer",{res:u,position:n,digit:i,playerId:f,clientId:A,moveCount:a})),u!==r.A.WINNING_MOVE&&u!==r.A.DRAW_MOVE||(l=!0,await v.call("gameover",{res:u,position:n,digit:i,playerId:f,clientId:A,moveCount:a})),{res:u,position:n,digit:i,playerId:f,clientId:A}},m=g.size,x=()=>A.colorOrder[e],O=()=>{a=0,l=!1,s=-1,c=-1,d=-1,f=r.A.init(m()),I=Array.from({length:m()}).fill(-1),e=u%n,g=r.A.field(f)};return{on:function(e,t){return v.on(e,t)},size:m,tryMove:function(){return p(s,c,e)},setMove:p,enum1:()=>function*(){for(let e=0;e<g.size();++e)yield[e,o(d===e,s===e,g.getCharSafe(e),A.colorOrder,I[e])]}(),setActivePosition:function(n){t!==e||l||(s=g.canSet(n)?n:-1)},setActiveDigitIndex:function(n){t!==e||l||(c=n)},currentColor:x,getActiveDigitIndex:()=>c,endMessage:n=>n===r.A.DRAW_MOVE?"Draw":e!==t?"You lose":"You win",endMessage2:e=>e===r.A.DRAW_MOVE?"Draw":x()+" player win",toJson:t=>({currentUserIdx:e,clientUserIdx:t,playersSize:n,activeCellIndex:s,activeDigitIndex:c,lastMove:d,gameover:l,fieldArr:g.toArr(),movesIdx:I}),isGameOver:()=>l,isMyMove:()=>!l&&e===t,calcLastMoveRes:()=>{if(d<0)return r.A.IMPOSSIBLE_MOVE;return g.checkWinning(d)},getCurrentIndex:()=>e,setClientIndex:e=>{t=e},getClientIndex:()=>t,getPlayersSize:()=>n,setMyTurn:()=>{e=t},nextRound:()=>{++u,O()},resetRound:O}}const d={presenterFunc:c,defaultPresenter:s,presenterFuncDefault:function(e){return c(s(e),e)}}},272:(e,t,n)=>{function r(e){return function(e,t){const n=e+Math.random()*(t-e);return Math.floor(n)}(0,e)}n.d(t,{A:()=>i});const i={makeId:function(e,t){let n="";const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let i=0;i<e;i++)n+=r.charAt(Math.floor(62*t()));return n},randomEl:function(e){return e[r(e.length)]}}}}]);