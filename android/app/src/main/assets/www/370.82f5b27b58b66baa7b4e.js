"use strict";(self.webpackChunksosgame=self.webpackChunksosgame||[]).push([[370],{782(e,n,t){t.d(n,{A:()=>o});var r=t(233);function o(e,n=0,t){const o=[];for(const[n]of Object.entries(e))o.push(n);let i=o.length;const s=n=>{const t=e[n];return(0,r.v)(t,`No id ${n} in clients`),t},c=e=>{const n=o[e];return(0,r.v)(n,"Bad Index"),s(n)},d=(e,n)=>{const t=e.index,r=o[t];o[e.index]=o[n.index],e.index=n.index,o[n.index]=r,n.index=t},l=e=>(e+o.length)%o.length;return{addClient:(n,t)=>{const s=e[n];s?s.name=t:(e[n]={index:i,name:t},o.push(n),++i),(0,r.v)(i===o.length)},remove:n=>{const t=e[n];--i;const s=o[i];o[t.index]=s,o.pop();e[s].index=t.index,e[n]=void 0,(0,r.v)(i===o.length)},swapInd:(e,n)=>{const t=c(e),r=c(n);d(t,r)},swapById:(e,n)=>{const t=s(e),r=s(n);d(t,r)},indById:e=>l(s(e).index+n),idByInd:e=>o[l(e-n)],isAllIgnored:e=>{const n=new Set(o),r=new Set(e);r.add(t);return 0===n.difference(r).size},size:()=>o.length}}},489(e,n,t){function r(e){let n=Promise.resolve();return{add:t=>new Promise((r,o)=>{if("function"!=typeof t)return e?.log("Not function! "+t),void o(new Error("Not function!"));n=n.then(t).then(r).catch(n=>{e?.error(n),o(n)})})}}t.d(n,{A:()=>r})},840(e,n,t){function r(e,n){return function(e,n,t){const r=e+t()*(n-e);return Math.floor(r)}(0,e,n)}t.d(n,{A:()=>o});const o={makeId:function(e,n){let t="";const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let o=0;o<e;o++)t+=r.charAt(Math.floor(62*n()));return t},randomEl:function(e,n=Math.random){return e[r(e.length,n)]}}},189(e,n,t){t.d(n,{A:()=>s});function r(e){switch(e){case 5:return"S";case 2:return"O";case 0:return" "}return""}function o(e){return Array.from({length:e}).fill(0)}function i(e){const n=[5,2],t=[-1,-1,...e,-1,-1],o=t.length-4,s=e=>e>=0&&e<o,c=e=>{for(let n=e+2;n<e+5;++n){if(5===t[n-2]&&2===t[n-1]&&5===t[n])return 3}for(let e=0;e<o;e++)if(0===t[e+2])return 1;return 2},d=e=>0===t[2+e],l=e=>s(e)&&d(e),u=()=>t.slice(2,-2);return{size:()=>o,setSafe:(e,n)=>l(n)?(((e,n)=>{t[2+n]=function(e){switch(e){case"S":case"s":return 5;case"O":case"o":return 2;case" ":return 0;case"":return-1}return-1}(e)})(e,n),c(n)):-1,setSafeByIndex:(e,r,o=!1)=>{if(!l(r))return-1;if(e<0||e>=n.length)return-1;const i=t[2+r];t[2+r]=n[e];const s=c(r);return o&&(t[2+r]=i),s},getCharSafe:e=>s(e)?(e=>r(t[2+e]))(e):"",canSet:l,clone:()=>i(e),movesLeft:()=>t.reduce((e,n)=>e+(0===n),0),toArr:u,asString:()=>u().map(r).join(""),isEmpty:d,inBounds:s,checkWinning:c}}const s={defaultField:function(e){return i(o(e))},field:i,init:o,IMPOSSIBLE_MOVE:-1,NORMAL_MOVE:1,WINNING_MOVE:3,DRAW_MOVE:2}},370(e,n,t){t.r(n),t.d(n,{default:()=>p});var r=t(233),o=t(782),i=t(366),s=t(840),c=t(189);const d={bestMove:function(e,n=0,t=void 0){let r=c.A.IMPOSSIBLE_MOVE,o={res:r,digit:-1,position:-1};const i=t||e.size();for(let t=Math.max(n,0);t<Math.min(i,e.size());++t)for(let n=0;n<2;++n){const i=e.setSafeByIndex(n,t,!0);if(i===c.A.IMPOSSIBLE_MOVE)break;if(i===c.A.WINNING_MOVE)return{res:i,digit:n,position:t};r<i&&(r=i,o={res:r,digit:n,position:t})}return o}};const l={bestMove:function(e){const n=[],t=[];for(let r=0;r<e.size();++r)for(let o=0;o<2;++o){const i=e.clone(),s=i.setSafeByIndex(o,r);if(s===c.A.IMPOSSIBLE_MOVE)break;if(s===c.A.WINNING_MOVE)return{res:s,digit:o,position:r};d.bestMove(i,r-2,r+3).res===c.A.WINNING_MOVE?t.push({res:s,digit:o,position:r}):n.push({res:s,digit:o,position:r})}return n.length>0?s.A.randomEl(n):t.length>0?s.A.randomEl(t):void(0,r.v)(!1,"No moves")}};function u(e,n,t){const o=[],i=t.asString();let s=i.indexOf(e);for(;-1!==s;){const l=0,u=s+n,a=t.clone(),f=a.setSafeByIndex(l,u);(0,r.v)(f===c.A.NORMAL_MOVE,u);d.bestMove(a,u-2,u+3).res!==c.A.WINNING_MOVE&&o.push({res:4,digit:l,position:u}),s=i.indexOf(e,u+1)}return o}function a(e){const n=[],t=" "+e.asString()+" ",r=" ".repeat(9);let o=t.indexOf(r);for(;-1!==o;){const e=0,i=o+4-1,s=5;n.push({res:s,digit:e,position:i}),o=t.indexOf(r,o+1)}return n}function f(e){(0,r.v)(e.movesLeft()%2==1);const n=function(e){const n=[];return n.push(...u("   S",0,e)),n.push(...u("S   ",3,e)),n}(e);if(n.length>0)return s.A.randomEl(n);const t=a(e);return t.length>0?s.A.randomEl(t):l.bestMove(e)}function I(e){const n=e.toArr();let t=[],o=0,i=0,s=-1,c=-1;for(let e=0;e<n.length;e++){0===n[e]?(0===o&&(s=e),++o,c=e+1,o>i?(i=o,(0,r.v)(i===c-s),t=i%2==0?[s+i/2-1,s+i/2]:[(i-1)/2+s]):o===i&&((0,r.v)(i===c-s),i%2==0?(t.push(i/2+s-1),t.push(s+i/2)):t.push((i-1)/2+s))):(o=0,c=-1,s=-1)}return t}function v(e){(0,r.v)(e.movesLeft()%2==0);const n=e.asString();let t=n.indexOf("S  S");return t>=0?l.bestMove(e):(t=n.indexOf("   "),t<0?l.bestMove(e):function(e){const n=[],t=[],o=[],i=[];for(let s=0;s<e.size();++s)for(let l=1;l<2;++l){const u=e.clone(),a=u.setSafeByIndex(l,s);if(a===c.A.IMPOSSIBLE_MOVE)break;a===c.A.WINNING_MOVE&&(0,r.v)(!1,"Bad state");if(d.bestMove(u,s-2,s+3).res===c.A.WINNING_MOVE)t.push({res:a,digit:l,position:s});else{const e=f(u);4===e.res?o.push({res:a,digit:l,position:s}):5===e.res?i.push({res:a,digit:l,position:s}):n.push({res:a,digit:l,position:s})}}if(n.length>0)return s.A.randomEl(n);if(i.length>0)return s.A.randomEl(i);if(o.length>0)return s.A.randomEl(o);if(t.length>0)return s.A.randomEl(t);(0,r.v)(!1,"No moves")}(e))}const g={bestMove:function(e){const n=d.bestMove(e);if(n.res===c.A.WINNING_MOVE)return n;if(e.movesLeft()%2==1){const n=f(e);return n.res>c.A.DRAW_MOVE&&(n.res=c.A.NORMAL_MOVE),n}return v(e)},findPattern:u,findLongEmpty:a,longestEmptyMids:I,randomEmptyMid:function(e){s.A.randomEl(I(e))},SOOS_MOVE:4,FIRST_S_MOVE:5};var A=t(373);function M(e,n){const t=e.getCurrentIndex();if(t===e.getClientIndex())return;const o=e.toJson(t);(0,r.v)(o.currentUserIdx===t,"Corrupt data");const i=g.bestMove(c.A.field(o.fieldArr));return i.playerId=t,n.onMessage(i)}async function p(e,n,t,r){const s=A.A.presenterFuncDefault(t),c=r(e,n,t,s),d=s.getClientIndex(),l=(0,o.A)({},d,"user");l.addClient("user","user");for(let e=1;e<s.getPlayersSize();++e){const n="bot"+e;l.addClient(n,n)}return c.on("gameover",()=>{n.querySelector(".butInstall").classList.remove("hidden2")}),c.on("message",async e=>{e.playerId===d&&(await(0,i.c)(100),await M(s,c))}),c.on("winclosed",()=>(s.nextRound(),c.redraw(),M(s,c))),s.resetRound(),c.redraw(),await M(s,c),c}},373(e,n,t){t.d(n,{A:()=>l});var r=t(189),o=t(130),i=t(489);function s(e,n,t,r,o){const i=t;let s="";return o>=0&&o<r.length&&(s=r[o]),{isLastMove:e,isActive:n,text:i,color:s}}function c(e){return{clientUserIdx:e.colorOrder.indexOf(e.color),currentUserIdx:0,playersSize:e.playerLimit,activeCellIndex:-1,activeDigitIndex:-1,lastMove:-1,gameover:!0,round:0,moveCount:0,fieldArr:r.A.init(e.size),movesIdx:Array.from({length:e.size}).fill(-1)}}function d({currentUserIdx:e,clientUserIdx:n,playersSize:t,activeCellIndex:c,activeDigitIndex:d,lastMove:l,gameover:u,round:a,moveCount:f,fieldArr:I,movesIdx:v},g){let A=r.A.field(I);const M=(0,i.A)(console),p=(0,o.A)(["moveEnd","nextPlayer","gameover"]),m=p.on;const h=()=>{e=(e+1)%t},O=async function(t,o,i){if(!((e,n,t,r)=>!(n<0||n>=2)&&t===r&&A.canSet(e))(t,o,i,e))return{res:r.A.IMPOSSIBLE_MOVE,position:-1,digit:-1,playerId:e,clientId:i};const s=A.setSafeByIndex(o,t);if(s===r.A.IMPOSSIBLE_MOVE)return{res:s,position:-1,digit:-1,playerId:e,clientId:i};c=-1,d=-1,v[t]=i,l=t,++f;const a=e,I=n;return await p.call("moveEnd",{res:s,position:t,digit:o,playerId:a,clientId:I,moveCount:f}),s===r.A.NORMAL_MOVE&&(h(),await p.call("nextPlayer",{res:s,position:t,digit:o,playerId:a,clientId:I,moveCount:f})),s!==r.A.WINNING_MOVE&&s!==r.A.DRAW_MOVE||(u=!0,await p.call("gameover",{res:s,position:t,digit:o,playerId:a,clientId:I,moveCount:f})),{res:s,position:t,digit:o,playerId:a,clientId:I}},x=(e,n,t)=>M.add(()=>O(e,n,t)),E=A.size,S=()=>g.colorOrder[e],y=()=>{f=0,u=!1,c=-1,d=-1,l=-1,I=r.A.init(E()),v=Array.from({length:E()}).fill(-1),e=a%t,A=r.A.field(I)};return{on:m,size:E,tryMove:()=>x(c,d,e),setMoveAsync:x,enum1:()=>function*(){for(let e=0;e<A.size();++e)yield[e,s(l===e,c===e,A.getCharSafe(e),g.colorOrder,v[e])]}(),setActivePosition:function(t){n!==e||u||(c=A.canSet(t)?t:-1)},setActiveDigitIndex:function(t){n!==e||u||(d=t)},currentColor:S,isActiveDigit:e=>e===d,endMessage:t=>t===r.A.DRAW_MOVE?"Draw":e!==n?"You lose":"You win",endMessage2:e=>e===r.A.DRAW_MOVE?"Draw":S()+" player win",toJson:n=>({currentUserIdx:e,clientUserIdx:n,playersSize:t,activeCellIndex:c,activeDigitIndex:d,lastMove:l,gameover:u,fieldArr:A.toArr(),movesIdx:v,moveCount:f}),isGameOver:()=>u,isMyMove:()=>!u&&e===n,calcLastMoveRes:()=>{if(l<0)return r.A.IMPOSSIBLE_MOVE;return A.checkWinning(l)},getCurrentIndex:()=>e,setClientIndex:e=>{n=e},getClientIndex:()=>n,getPlayersSize:()=>t,setMyTurn:()=>{e=n},nextRound:()=>{++a,y()},resetRound:y}}const l={presenterFunc:d,defaultPresenter:c,presenterFuncDefault:function(e){return d(c(e),e)}}}}]);