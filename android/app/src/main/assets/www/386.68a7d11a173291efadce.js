"use strict";(self.webpackChunksosgame=self.webpackChunksosgame||[]).push([[386],{782(e,n,t){t.d(n,{A:()=>o});var r=t(233);function o(e,n=0,t){const o=[];for(const[n]of Object.entries(e))o.push(n);let i=o.length;const s=n=>{const t=e[n];return(0,r.v)(t,`No id ${n} in clients`),t},c=e=>{const n=o[e];return(0,r.v)(n,"Bad Index"),s(n)},d=(e,n)=>{const t=e.index,r=o[t];o[e.index]=o[n.index],e.index=n.index,o[n.index]=r,n.index=t},l=e=>(e+o.length)%o.length;return{addClient:(n,t)=>{const s=e[n];s?s.name=t:(e[n]={index:i,name:t},o.push(n),++i),(0,r.v)(i===o.length)},remove:n=>{const t=e[n];--i;const s=o[i];o[t.index]=s,o.pop();e[s].index=t.index,e[n]=void 0,(0,r.v)(i===o.length)},swapInd:(e,n)=>{const t=c(e),r=c(n);d(t,r)},swapById:(e,n)=>{const t=s(e),r=s(n);d(t,r)},indById:e=>l(s(e).index+n),idByInd:e=>o[l(e-n)],isAllIgnored:e=>{const n=new Set(o),r=new Set(e);r.add(t);return 0===n.difference(r).size},size:()=>o.length}}},510(e,n,t){t.d(n,{A:()=>r});const r=function(e){return{message:e.onMessage}}},189(e,n,t){t.d(n,{A:()=>s});function r(e){switch(e){case 5:return"S";case 2:return"O";case 0:return" "}return""}function o(e){return Array.from({length:e}).fill(0)}function i(e){const n=[5,2],t=[-1,-1,...e,-1,-1],o=t.length-4,s=e=>e>=0&&e<o,c=e=>{for(let n=e+2;n<e+5;++n){if(5===t[n-2]&&2===t[n-1]&&5===t[n])return 3}for(let e=0;e<o;e++)if(0===t[e+2])return 1;return 2},d=e=>0===t[2+e],l=e=>s(e)&&d(e),a=()=>t.slice(2,-2);return{size:()=>o,setSafe:(e,n)=>l(n)?(((e,n)=>{t[2+n]=function(e){switch(e){case"S":case"s":return 5;case"O":case"o":return 2;case" ":return 0;case"":return-1}return-1}(e)})(e,n),c(n)):-1,setSafeByIndex:(e,r,o=!1)=>{if(!l(r))return-1;if(e<0||e>=n.length)return-1;const i=t[2+r];t[2+r]=n[e];const s=c(r);return o&&(t[2+r]=i),s},getCharSafe:e=>s(e)?(e=>r(t[2+e]))(e):"",canSet:l,clone:()=>i(e),movesLeft:()=>t.reduce((e,n)=>e+(0===n),0),toArr:a,asString:()=>a().map(r).join(""),isEmpty:d,inBounds:s,checkWinning:c}}const s={defaultField:function(e){return i(o(e))},field:i,init:o,IMPOSSIBLE_MOVE:-1,NORMAL_MOVE:1,WINNING_MOVE:3,DRAW_MOVE:2}},386(e,n,t){t.r(n),t.d(n,{default:()=>a});var r=t(421),o=t(268),i=t(401),s=t(788),c=t(530),d=t(369),l=t(301);async function a(e,n,t,a){(0,d.A)(n,t);const u=s.A.getMyId(e,t,Math.random);t.serverId=u;const f=(0,c.A)(n,t),I=await(0,o.A)(u,u,e.location,t,f),g=(0,r.wZ)(e,n,t,u),v=(0,i.A)(u,f,I),A=(0,r.Ef)(e,n,t,a,v,v,u);return A.on("started",()=>{(0,l.k6)(g)}),await v.connect(),A}},421(e,n,t){t.d(n,{Ef:()=>f,wZ:()=>I});var r=t(782),o=t(530),i=t(130);var s=t(788),c=t(301),d=t(510),l=t(975),a=t(373);function u(e,n,t,s,c,a,u){const f=(0,r.A)({},t.getClientIndex(),s);f.addClient(s,s);const I=(0,o.A)(e,c,10);n.on("winclosed",()=>(t.nextRound(),n.redraw(),function(e,n){const t={serverId:n};return e.sendRawAll("reconnect",t)}(u,s))),u.on("join",r=>{I.log("join",r),f.addClient(r.from,r.from);const o=f.indById(r.from),i=f.indById(s);f.size()===c.playerLimit&&t.isGameOver()&&(t.resetRound(),(0,l.b)(e));const d=t.toJson(o),u={serverId:s,joinedInd:o,serverInd:i,presenter:d};return a.sendRawTo("gameinit",u,r.from),n.redraw()});const g=(0,d.A)(n),v=function(e){const n=Object.keys(e),t=(0,i.A)(n);for(const[n,r]of Object.entries(e))t.on(n,r);return t}(g);u.registerHandler(v),function(e,n,t,r,o){for(const i of o)r.log("register "+i),e.on(i,e=>{let o;if(e&&void 0!==e.playerId&&(o=[t.idByInd(e.playerId)],t.isAllIgnored(o)))r.log("ignore "+i);else{r.log("send "+i);try{n.sendRawAll(i,e,o)}catch(e){r.error(e)}r.log("after call "+i)}})}(n,u,f,I,Object.keys(g))}function f(e,n,t,r,o,i,s){const c=a.A.presenterFuncDefault(t),d=r(e,n,t,c);return u(n,d,c,s,t,i,o),d}function I(e,n,t,r){const o=s.A.getHostUrl(t,e.location),i=new URL(o);r&&i.searchParams.set("serverId",r);return(0,c.$i)(i.toString(),e,n,t,{source:"./images/sos.png",width:"10%",height:"20%",x:"center",y:"center"})}},373(e,n,t){t.d(n,{A:()=>l});var r=t(189),o=t(130),i=t(489);function s(e,n,t,r,o){const i=t;let s="";return o>=0&&o<r.length&&(s=r[o]),{isLastMove:e,isActive:n,text:i,color:s}}function c(e){return{clientUserIdx:e.colorOrder.indexOf(e.color),currentUserIdx:0,playersSize:e.playerLimit,activeCellIndex:-1,activeDigitIndex:-1,lastMove:-1,gameover:!0,round:0,moveCount:0,fieldArr:r.A.init(e.size),movesIdx:Array.from({length:e.size}).fill(-1)}}function d({currentUserIdx:e,clientUserIdx:n,playersSize:t,activeCellIndex:c,activeDigitIndex:d,lastMove:l,gameover:a,round:u,moveCount:f,fieldArr:I,movesIdx:g},v){let A=r.A.field(I);const y=(0,i.A)(console),m=(0,o.A)(["moveEnd","nextPlayer","gameover"]),x=m.on;const p=()=>{e=(e+1)%t},M=async function(t,o,i){if(!((e,n,t,r)=>!(n<0||n>=2)&&t===r&&A.canSet(e))(t,o,i,e))return{res:r.A.IMPOSSIBLE_MOVE,position:-1,digit:-1,playerId:e,clientId:i};const s=A.setSafeByIndex(o,t);if(s===r.A.IMPOSSIBLE_MOVE)return{res:s,position:-1,digit:-1,playerId:e,clientId:i};c=-1,d=-1,g[t]=i,l=t,++f;const u=e,I=n;return await m.call("moveEnd",{res:s,position:t,digit:o,playerId:u,clientId:I,moveCount:f}),s===r.A.NORMAL_MOVE&&(p(),await m.call("nextPlayer",{res:s,position:t,digit:o,playerId:u,clientId:I,moveCount:f})),s!==r.A.WINNING_MOVE&&s!==r.A.DRAW_MOVE||(a=!0,await m.call("gameover",{res:s,position:t,digit:o,playerId:u,clientId:I,moveCount:f})),{res:s,position:t,digit:o,playerId:u,clientId:I}},h=(e,n,t)=>y.add(()=>M(e,n,t)),S=A.size,O=()=>v.colorOrder[e],w=()=>{f=0,a=!1,c=-1,d=-1,l=-1,I=r.A.init(S()),g=Array.from({length:S()}).fill(-1),e=u%t,A=r.A.field(I)};return{on:x,size:S,tryMove:()=>h(c,d,e),setMoveAsync:h,enum1:()=>function*(){for(let e=0;e<A.size();++e)yield[e,s(l===e,c===e,A.getCharSafe(e),v.colorOrder,g[e])]}(),setActivePosition:function(t){n!==e||a||(c=A.canSet(t)?t:-1)},setActiveDigitIndex:function(t){n!==e||a||(d=t)},currentColor:O,isActiveDigit:e=>e===d,endMessage:t=>t===r.A.DRAW_MOVE?"Draw":e!==n?"You lose":"You win",endMessage2:e=>e===r.A.DRAW_MOVE?"Draw":O()+" player win",toJson:n=>({currentUserIdx:e,clientUserIdx:n,playersSize:t,activeCellIndex:c,activeDigitIndex:d,lastMove:l,gameover:a,fieldArr:A.toArr(),movesIdx:g,moveCount:f}),isGameOver:()=>a,isMyMove:()=>!a&&e===n,calcLastMoveRes:()=>{if(l<0)return r.A.IMPOSSIBLE_MOVE;return A.checkWinning(l)},getCurrentIndex:()=>e,setClientIndex:e=>{n=e},getClientIndex:()=>n,getPlayersSize:()=>t,setMyTurn:()=>{e=n},nextRound:()=>{++u,w()},resetRound:w}}const l={presenterFunc:d,defaultPresenter:c,presenterFuncDefault:function(e){return d(c(e),e)}}},975(e,n,t){function r(e){e.querySelector(".game").classList.remove("hidden");e.querySelector(".lobby").classList.add("hidden");const n=e.querySelector(".menu");n.querySelector(".control-panel")?.classList.add("absolute");e.querySelector(".log").innerHTML=""}t.d(n,{b:()=>r})}}]);