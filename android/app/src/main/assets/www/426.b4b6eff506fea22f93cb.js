"use strict";(self.webpackChunksosgame=self.webpackChunksosgame||[]).push([[426],{657:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(379);function i(e,t=0){const n=[];for(const[t]of Object.entries(e))n.push(t);let i=n.length;const o=t=>{const i=n[t];(0,r.vA)(i,"Bad Index");const o=e[i];return(0,r.vA)(o,"Empty client"),o},s=t=>{const n=e[t];return(0,r.vA)(n,`No id ${t} in clients`),n},d=(e,t)=>{const r=e.index,i=n[r];n[e.index]=n[t.index],e.index=t.index,n[t.index]=i,t.index=r},l=e=>(e+n.length)%n.length;return{addClient:(t,o)=>{const s=e[t];s?s.name=o:(e[t]={index:i,name:o},n.push(t),++i),(0,r.vA)(i===n.length)},remove:t=>{const o=e[t];--i;const s=n[i];n[o.index]=s,n.pop();e[s].index=o.index,e[t]=void 0,(0,r.vA)(i===n.length)},swapInd:(e,t)=>{const n=o(e),r=o(t);d(n,r)},swapById:(e,t)=>{const n=s(e),r=s(t);d(n,r)},indById:e=>l(s(e).index+t),idByInd:e=>n[l(e-t)],size:()=>n.length}}},426:(e,t,n)=>{n.r(t),n.d(t,{default:()=>u});var r=n(373),i=n(379),o=n(272),s=n(189);const d={bestMove:function(e,t=0,n=void 0){let r=s.A.IMPOSSIBLE_MOVE,i={res:r,digit:-1,position:-1};const o=n||e.size();for(let n=Math.max(t,0);n<Math.min(o,e.size());++n)for(let t=0;t<2;++t){const o=e.setSafeByIndex(t,n,!0);if(o===s.A.IMPOSSIBLE_MOVE)break;if(o===s.A.WINNING_MOVE)return{res:o,digit:t,position:n};r<o&&(r=o,i={res:r,digit:t,position:n})}return i}};const l={bestMove:function(e){const t=[],n=[];for(let r=0;r<e.size();++r)for(let i=0;i<2;++i){const o=e.clone(),l=o.setSafeByIndex(i,r);if(l===s.A.IMPOSSIBLE_MOVE)break;if(l===s.A.WINNING_MOVE)return{res:l,digit:i,position:r};d.bestMove(o,r-2,r+3).res!==s.A.WINNING_MOVE?t.push({res:l,digit:i,position:r}):n.push({res:l,digit:i,position:r})}return t.length>0?o.A.randomEl(t):n.length>0?o.A.randomEl(n):void(0,i.vA)(!1,"No moves")}};var c=n(657);function a(e,t){const n=e.getCurrentIndex();if(n===e.getClientIndex())return;const r=e.toJson(n);(0,i.vA)(r.currentUserIdx===n,"Corrupt data");const o=l.bestMove(s.A.field(r.fieldArr));return o.playerId=n,t.onMessage(o)}function u(e,t,n,o){return new Promise((s=>{const d=r.A.presenterFuncDefault(n),l=o(e,t,n,d),u=d.getClientIndex(),f=(0,c.A)({},u);f.addClient("user","user");for(let e=1;e<d.getPlayersSize();++e){const t="bot"+e;f.addClient(t,t)}l.on("gameover",(()=>{t.querySelector(".butInstall").classList.remove("hidden2")})),l.on("message",(async e=>{e.playerId===u&&(await(0,i.cb)(100),await a(d,l))})),l.on("winclosed",(()=>{d.nextRound(),l.redraw(),a(d,l)})),d.resetRound(),a(d,l),l.redraw(),s(l)}))}},373:(e,t,n)=>{n.d(t,{A:()=>l});var r=n(189),i=n(746);function o(e,t,n,r,i){let o=n,s="";return i>=0&&i<r.length&&(s=r[i]),{isLastMove:e,isActive:t,text:o,color:s}}function s(e){return{clientUserIdx:e.colorOrder.indexOf(e.color),currentUserIdx:0,playersSize:e.playerLimit,activeCellIndex:-1,activeDigitIndex:-1,lastMove:-1,gameover:!0,gamestarted:!1,round:0,fieldArr:r.A.init(e.size),movesIdx:Array.from({length:e.size}).fill(-1)}}function d({currentUserIdx:e,clientUserIdx:t,playersSize:n,activeCellIndex:s,activeDigitIndex:d,lastMove:l,gameover:c,gamestarted:a,round:u,fieldArr:f,movesIdx:I},v){let g=r.A.field(f);const A=(0,i.A)(["firstmove","gameover"]);const x=()=>{e=(e+1)%n},M=function(n,i,o){if(!((e,t,n,r)=>!(t<0||t>=2)&&n===r&&g.canSet(e))(n,i,o,e))return{res:r.A.IMPOSSIBLE_MOVE,position:-1,digit:-1,playerId:e,clientId:o};const u=g.setSafeByIndex(i,n);if(u===r.A.IMPOSSIBLE_MOVE)return{res:u,position:-1,digit:-1,playerId:e,clientId:o};s=-1,d=-1,a||A.call("firstmove",{}),a=!0,I[n]=o,l=n;const f=e,v=t;return u===r.A.NORMAL_MOVE&&x(),u!==r.A.WINNING_MOVE&&u!==r.A.DRAW_MOVE||(c=!0,A.call("gameover",u)),{res:u,position:n,digit:i,playerId:f,clientId:v}},m=g.size,p=()=>v.colorOrder[e],h=()=>{a=!1,c=!1,s=-1,d=-1,l=-1,f=r.A.init(m()),I=Array.from({length:m()}).fill(-1),e=u%n,g=r.A.field(f)};return{on:function(e,t){return A.on(e,t)},size:m,tryMove:function(){return M(s,d,e)},setMove:M,enum1:()=>function*(){for(let e=0;e<g.size();++e)yield[e,o(l===e,s===e,g.getCharSafe(e),v.colorOrder,I[e])]}(),setActivePosition:function(n){t!==e||c||(s=g.canSet(n)?n:-1)},setActiveDigitIndex:function(n){t!==e||c||(d=n)},currentColor:p,getActiveDigitIndex:()=>d,endMessage:n=>n===r.A.DRAW_MOVE?"Draw":e!==t?"You lose":"You win",endMessage2:e=>e===r.A.DRAW_MOVE?"Draw":p()+" player win",toJson:t=>({currentUserIdx:e,clientUserIdx:t,playersSize:n,activeCellIndex:s,activeDigitIndex:d,lastMove:l,gameover:c,fieldArr:g.toArr(),movesIdx:I}),isGameOver:()=>c,isMyMove:()=>!c&&e===t,calcLastMoveRes:()=>{if(l<0)return r.A.IMPOSSIBLE_MOVE;return g.checkWinning(l)},getCurrentIndex:()=>e,setClientIndex:e=>{t=e},getClientIndex:()=>t,getPlayersSize:()=>n,setMyTurn:()=>{e=t},nextRound:()=>{++u,h()},resetRound:h}}const l={presenterFunc:d,defaultPresenter:s,presenterFuncDefault:function(e){return d(s(e),e)}}},272:(e,t,n)=>{function r(e){return function(e,t){let n=e+Math.random()*(t-e);return Math.floor(n)}(0,e)}n.d(t,{A:()=>i});const i={makeId:function(e,t){let n="";const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let i=0;i<e;i++)n+=r.charAt(Math.floor(62*t()));return n},randomEl:function(e){return e[r(e.length)]}}}}]);