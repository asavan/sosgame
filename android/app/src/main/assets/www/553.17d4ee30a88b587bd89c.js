"use strict";(self.webpackChunksosgame=self.webpackChunksosgame||[]).push([[553],{553:(e,t,r)=>{r.r(t),r.d(t,{default:()=>u});var n=r(373),i=r(379),o=r(189);function s(e,t=0,r=void 0){let n=o.A.IMPOSSIBLE_MOVE,i={res:n,digit:-1,position:-1};const s=r||e.size();for(let r=Math.max(t,0);r<Math.min(s,e.size());++r)for(let t=0;t<2;++t){const s=e.setSafeByIndex(t,r,!0);if(s===o.A.IMPOSSIBLE_MOVE)break;if(s===o.A.WINNING_MOVE)return{res:s,digit:t,position:r};n<s&&(n=s,i={res:n,digit:t,position:r})}return i}function c(e){let t={res:o.A.IMPOSSIBLE_MOVE,digit:-1,position:-1};for(let r=0;r<e.size();++r)for(let n=0;n<2;++n){const i=e.clone(),c=i.setSafeByIndex(n,r);if(c===o.A.IMPOSSIBLE_MOVE)break;if(s(i,r-2,r+3).res!==o.A.WINNING_MOVE)return{res:c,digit:n,position:r};t={res:c,digit:n,position:r}}return t}function l(e){const t=s(e);return t.res===o.A.WINNING_MOVE?t:c(e)}const a={bestMove:s,notLoosingMove:c,simpleMove:l,simpleMoveArr:function(e){return l(o.A.field(e))}};function d(e,t,r){const n=e.toJson(t);if(n.currentUserIdx!==t)return;const i=a.simpleMoveArr(n.fieldArr);return i.playerId=t,r.onMessage(i)}function u(e,t,r,o){return new Promise((s=>{const c=n.A.presenterFuncDefault(r),l=o(e,t,r,c);l.on("gameover",(()=>{t.querySelector(".butInstall").classList.remove("hidden2")})),l.on("message",(async e=>{0===e.playerId&&(await(0,i.cb)(100),await d(c,1,l))})),l.on("winclosed",(()=>{c.nextRound(),l.redraw(),d(c,1,l)})),d(c,1,l),s(l)}))}},373:(e,t,r)=>{r.d(t,{A:()=>l});var n=r(189),i=r(746);function o(e,t,r,n,i){let o=r,s="";return i>=0&&i<n.length&&(s=n[i]),{isLastMove:e,isActive:t,text:o,color:s}}function s(e){return{clientUserIdx:e.colorOrder.indexOf(e.color),currentUserIdx:e.colorOrder.indexOf(e.color),playersSize:e.colorOrder.length,activeCellIndex:-1,activeDigitIndex:-1,lastMove:-1,gameover:!1,gamestarted:!1,round:0,fieldArr:n.A.init(e.size),movesIdx:Array(e.size).fill(-1)}}function c({currentUserIdx:e,clientUserIdx:t,playersSize:r,activeCellIndex:s,activeDigitIndex:c,lastMove:l,gameover:a,gamestarted:d,round:u,fieldArr:f,movesIdx:I},M){let A=n.A.field(f);const v=(0,i.A)(["firstmove","gameover"]);const g=function(i,o,u){if(!((e,t,r,n)=>!(t<0||t>=2)&&r==n&&A.canSet(e))(i,o,u,e))return{res:n.A.IMPOSSIBLE_MOVE,position:-1,digit:-1,playerId:e,clientId:u};const f=A.setSafeByIndex(o,i);if(f===n.A.IMPOSSIBLE_MOVE)return{res:f,position:-1,digit:-1,playerId:e,clientId:u};s=-1,c=-1,d||v.call("firstmove",{}),d=!0,I[i]=u,l=i;const g=e,O=t;return f===n.A.NORMAL_MOVE&&(e=(e+1)%r,"hotseat"===M.mode&&(t=e)),f!==n.A.WINNING_MOVE&&f!==n.A.DRAW_MOVE||(a=!0,v.call("gameover",f)),{res:f,position:i,digit:o,playerId:g,clientId:O}},O=A.size,p=()=>M.colorOrder[e];return{on:function(e,t){return v.on(e,t)},size:O,tryMove:function(){return g(s,c,e)},setMove:g,enum1:()=>function*(){for(let e=0;e<A.size();++e)yield[e,o(l===e,s===e,A.getCharSafe(e),M.colorOrder,I[e])]}(),setActivePosition:function(r){t!==e||a||(s=A.canSet(r)?r:-1)},setActiveDigitIndex:function(r){t!==e||a||(c=r)},currentColor:p,getActiveDigitIndex:()=>c,endMessage:r=>r===n.A.DRAW_MOVE?"Draw":e!==t?"You lose":"You win",endMessage2:e=>e===n.A.DRAW_MOVE?"Draw":p()+" player win",toJson:t=>({currentUserIdx:e,clientUserIdx:t,playersSize:r,activeCellIndex:s,activeDigitIndex:c,lastMove:l,gameover:a,fieldArr:A.toArr(),movesIdx:I}),isGameOver:()=>a,isMyMove:()=>!a&&e===t,calcLastMoveRes:()=>{if(l<0)return n.A.IMPOSSIBLE_MOVE;return A.checkWinning(l)},nextRound:()=>{++u,d=!1,a=!1,s=-1,c=-1,l=-1,a=!1,d=!1,f=n.A.init(M.size),I=Array(M.size).fill(-1),e=(t+u)%r,A=n.A.field(f)}}}const l={presenterFunc:c,defaultPresenter:s,presenterFuncDefault:function(e){return c(s(e),e)}}}}]);