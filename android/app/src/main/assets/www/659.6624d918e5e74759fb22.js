"use strict";(self.webpackChunksosgame=self.webpackChunksosgame||[]).push([[659],{489(e,t,n){function r(e){let t=Promise.resolve();return{add:n=>new Promise((r,i)=>{if("function"!=typeof n)return e?.log("Not function! "+n),void i(new Error("Not function!"));t=t.then(n).then(r).catch(t=>{e?.error(t),i(t)})})}}n.d(t,{A:()=>r})},189(e,t,n){n.d(t,{A:()=>s});function r(e){switch(e){case 5:return"S";case 2:return"O";case 0:return" "}return""}function i(e){return Array.from({length:e}).fill(0)}function o(e){const t=[5,2],n=[-1,-1,...e,-1,-1],i=n.length-4,s=e=>e>=0&&e<i,c=e=>{for(let t=e+2;t<e+5;++t){if(5===n[t-2]&&2===n[t-1]&&5===n[t])return 3}for(let e=0;e<i;e++)if(0===n[e+2])return 1;return 2},l=e=>0===n[2+e],a=e=>s(e)&&l(e),u=()=>n.slice(2,-2);return{size:()=>i,setSafe:(e,t)=>a(t)?(((e,t)=>{n[2+t]=function(e){switch(e){case"S":case"s":return 5;case"O":case"o":return 2;case" ":return 0;case"":return-1}return-1}(e)})(e,t),c(t)):-1,setSafeByIndex:(e,r,i=!1)=>{if(!a(r))return-1;if(e<0||e>=t.length)return-1;const o=n[2+r];n[2+r]=t[e];const s=c(r);return i&&(n[2+r]=o),s},getCharSafe:e=>s(e)?(e=>r(n[2+e]))(e):"",canSet:a,clone:()=>o(e),movesLeft:()=>n.reduce((e,t)=>e+(0===t),0),toArr:u,asString:()=>u().map(r).join(""),isEmpty:l,inBounds:s,checkWinning:c}}const s={defaultField:function(e){return o(i(e))},field:o,init:i,IMPOSSIBLE_MOVE:-1,NORMAL_MOVE:1,WINNING_MOVE:3,DRAW_MOVE:2}},659(e,t,n){n.r(t),n.d(t,{default:()=>o});var r=n(373),i=n(975);function o(e,t,n,o){(0,i.b)(t);const s=r.A.presenterFuncDefault(n);s.setMyTurn();const c=o(e,t,n,s);return s.on("nextPlayer",()=>(s.setClientIndex(s.getCurrentIndex()),c.redraw())),s.resetRound(),c.redraw(),Promise.resolve(c)}},373(e,t,n){n.d(t,{A:()=>a});var r=n(189),i=n(130),o=n(489);function s(e,t,n,r,i){const o=n;let s="";return i>=0&&i<r.length&&(s=r[i]),{isLastMove:e,isActive:t,text:o,color:s}}function c(e){return{clientUserIdx:e.colorOrder.indexOf(e.color),currentUserIdx:0,playersSize:e.playerLimit,activeCellIndex:-1,activeDigitIndex:-1,lastMove:-1,gameover:!0,round:0,moveCount:0,fieldArr:r.A.init(e.size),movesIdx:Array.from({length:e.size}).fill(-1)}}function l({currentUserIdx:e,clientUserIdx:t,playersSize:n,activeCellIndex:c,activeDigitIndex:l,lastMove:a,gameover:u,round:d,moveCount:f,fieldArr:I,movesIdx:v},g){let A=r.A.field(I);const y=(0,o.A)(console),m=(0,i.A)(["moveEnd","nextPlayer","gameover"]),M=m.on;const x=()=>{e=(e+1)%n},S=async function(n,i,o){if(!((e,t,n,r)=>!(t<0||t>=2)&&n===r&&A.canSet(e))(n,i,o,e))return{res:r.A.IMPOSSIBLE_MOVE,position:-1,digit:-1,playerId:e,clientId:o};const s=A.setSafeByIndex(i,n);if(s===r.A.IMPOSSIBLE_MOVE)return{res:s,position:-1,digit:-1,playerId:e,clientId:o};c=-1,l=-1,v[n]=o,a=n,++f;const d=e,I=t;return await m.call("moveEnd",{res:s,position:n,digit:i,playerId:d,clientId:I,moveCount:f}),s===r.A.NORMAL_MOVE&&(x(),await m.call("nextPlayer",{res:s,position:n,digit:i,playerId:d,clientId:I,moveCount:f})),s!==r.A.WINNING_MOVE&&s!==r.A.DRAW_MOVE||(u=!0,await m.call("gameover",{res:s,position:n,digit:i,playerId:d,clientId:I,moveCount:f})),{res:s,position:n,digit:i,playerId:d,clientId:I}},p=(e,t,n)=>y.add(()=>S(e,t,n)),O=A.size,h=()=>g.colorOrder[e],E=()=>{f=0,u=!1,c=-1,l=-1,a=-1,I=r.A.init(O()),v=Array.from({length:O()}).fill(-1),e=d%n,A=r.A.field(I)};return{on:M,size:O,tryMove:()=>p(c,l,e),setMoveAsync:p,enum1:()=>function*(){for(let e=0;e<A.size();++e)yield[e,s(a===e,c===e,A.getCharSafe(e),g.colorOrder,v[e])]}(),setActivePosition:function(n){t!==e||u||(c=A.canSet(n)?n:-1)},setActiveDigitIndex:function(n){t!==e||u||(l=n)},currentColor:h,isActiveDigit:e=>e===l,endMessage:n=>n===r.A.DRAW_MOVE?"Draw":e!==t?"You lose":"You win",endMessage2:e=>e===r.A.DRAW_MOVE?"Draw":h()+" player win",toJson:t=>({currentUserIdx:e,clientUserIdx:t,playersSize:n,activeCellIndex:c,activeDigitIndex:l,lastMove:a,gameover:u,fieldArr:A.toArr(),movesIdx:v,moveCount:f}),isGameOver:()=>u,isMyMove:()=>!u&&e===t,calcLastMoveRes:()=>{if(a<0)return r.A.IMPOSSIBLE_MOVE;return A.checkWinning(a)},getCurrentIndex:()=>e,setClientIndex:e=>{t=e},getClientIndex:()=>t,getPlayersSize:()=>n,setMyTurn:()=>{e=t},nextRound:()=>{++d,E()},resetRound:E}}const a={presenterFunc:l,defaultPresenter:c,presenterFuncDefault:function(e){return l(c(e),e)}}},975(e,t,n){function r(e){e.querySelector(".game").classList.remove("hidden");e.querySelector(".lobby").classList.add("hidden");const t=e.querySelector(".menu");t.querySelector(".control-panel")?.classList.add("absolute");e.querySelector(".log").innerHTML=""}n.d(t,{b:()=>r})}}]);