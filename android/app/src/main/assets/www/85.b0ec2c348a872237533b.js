"use strict";(self.webpackChunksosgame=self.webpackChunksosgame||[]).push([[85],{192(e,n,t){t.d(n,{A:()=>r});const r={crush:(e,n=50)=>{let t=[];const r="-_.!~*'()";for(let e=127;--e;)(e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122||r.includes(String.fromCharCode(e)))&&t.push(String.fromCharCode(e));for(let e=32;e<255;++e){let n=String.fromCharCode(e);"\\"==n||t.includes(n)||t.unshift(n)}e=e.replace(new RegExp("","g"),"");const o=((e,t)=>{let r=t.length,i="";const o=e=>encodeURI(encodeURIComponent(e)).replace(/%../g,"i").length,c=e=>{let n=e.charCodeAt(0),t=e.charCodeAt(e.length-1);return n>=56320&&n<=57343||t>=55296&&t<=56319};let s={};for(let t=2;t<n;t++)for(let n=0;n<e.length-t;++n){let r=e.substr(n,t);if(s[r])continue;if(c(r))continue;let i=1;for(let o=e.indexOf(r,n+t);o>=0;++i)o=e.indexOf(r,o+t);i>1&&(s[r]=i)}for(;;){for(;r--&&e.includes(t[r]););if(r<0)break;let n,c=t[r],a=0,l=o(c);for(let e in s){let t=s[e],r=(t-1)*o(e)-(t+1)*l;i.length||(r-=o("")),r<=0?delete s[e]:r>a&&(n=e,a=r)}if(!n)break;e=e.split(n).join(c)+c+n,i=c+i;let d={};for(let t in s){let r=t.split(n).join(c),i=0;for(let n=e.indexOf(r);n>=0;++i)n=e.indexOf(r,n+r.length);i>1&&(d[r]=i)}s=d}return{a:e,b:i}})(e=i(e),t);let c=o.a;return o.b.length&&(c+=""+o.b),c+="_",c},uncrush:e=>{const n=(e=e.substring(0,e.length-1)).split("");let t=n[0];if(n.length>1){let e=n[1];for(let n of e){let e=t.split(n);t=e.join(e.pop())}}return i(t,0)}},i=(e,n=1)=>{const t=[['"',"'"],["':","!"],[",'","~"],["}",")","\\","\\"],["{","(","\\","\\"]],r=(e,n)=>{let t=new RegExp(`${(n[2]?n[2]:"")+n[0]}|${(n[3]?n[3]:"")+n[1]}`,"g");return e.replace(t,e=>e===n[0]?n[1]:n[0])};if(n)for(let n=0;n<t.length;++n)e=r(e,t[n]);else for(let n=t.length;n--;)e=r(e,t[n]);return e}},311(e,n,t){t.d(n,{cx:()=>c,y8:()=>s});var r=t(130),i=t(233);function o(e,n,t){const r=[];for(const i of e){if(!t.hasAction(i))continue;const e=t.getAction(i),o=n.on(i,e),c=()=>n.unsubscribe(i,o);r.push(c)}(0,i.v)(r.length>0,"Bad glue");return()=>{for(const e of r)e()}}function c(e,n,t,i,c){const s=Object.keys(n),a=(l=n,{hasAction:e=>Object.hasOwn(l,e),getAction:e=>l[e]});var l;const d=function(e,n,t,i,o){const c=(0,r.A)(n),s=e.on("message",e=>{if(o){if(t.log("Received message",e),e.from===o)return void t.error("same user");if(e.to!==o&&"all"!==e.to)return void t.log("another user");if(e.ignore&&Array.isArray(e.ignore)&&e.ignore.includes(o))return void t.log("user in ignore list")}c.hasAction(e.action)?i?c.call(e.action,e.data):c.call(e.action,e):t.log("not my action "+e.action)}),{on:a,getActions:l,unsubscribe:d}=c;return{on:a,getActions:l,unsubscribe:d,unsubscribeAll:()=>e.unsubscribe("message",s)}}(e,s,t,i,c),u=o(s,d,a);return()=>{u(),d.unsubscribeAll()}}function s(e,n,t,r,i,s,a,l,d){const u=function(e,n,t,r){return{hasAction:()=>!0,getAction:i=>o=>{!r||r(o)?e.send(i,o,n):t.log("ignore",o)}}}(t,l,i,d),f=o(n,e,u),g=c(t,r,i,s,a);return()=>{f(),g()}}},109(e,n,t){async function r(e,n){for(const t of e)t.candidate?await n.addIceCandidate(t):await n.addIceCandidate(null)}function i(e,n,t){const r=new RTCPeerConnection;return r.onicecandidate=r=>{if(n.log("Received icecandidate",e,r),!r)return void n.error("No ice");const i={type:"candidate",candidate:null};r.candidate&&(i.candidate=r.candidate.candidate,i.sdpMid=r.candidate.sdpMid,i.sdpMLineIndex=r.candidate.sdpMLineIndex),t.add(i),r.candidate||t.done()},r.oniceconnectionstatechange=e=>{n.log("connection statechange",r.iceConnectionState),"failed"!==r.iceConnectionState&&"disconnected"!==r.iceConnectionState||n.error("failed iceConnectionState",e)},r}t.d(n,{E:()=>r,q:()=>i})},510(e,n,t){t.d(n,{A:()=>r});const r=function(e){return{message:e.onMessage}}},189(e,n,t){t.d(n,{A:()=>c});function r(e){switch(e){case 5:return"S";case 2:return"O";case 0:return" "}return""}function i(e){return Array.from({length:e}).fill(0)}function o(e){const n=[5,2],t=[-1,-1,...e,-1,-1],i=t.length-4,c=e=>e>=0&&e<i,s=e=>{for(let n=e+2;n<e+5;++n){if(5===t[n-2]&&2===t[n-1]&&5===t[n])return 3}for(let e=0;e<i;e++)if(0===t[e+2])return 1;return 2},a=e=>0===t[2+e],l=e=>c(e)&&a(e),d=()=>t.slice(2,-2);return{size:()=>i,setSafe:(e,n)=>l(n)?(((e,n)=>{t[2+n]=function(e){switch(e){case"S":case"s":return 5;case"O":case"o":return 2;case" ":return 0;case"":return-1}return-1}(e)})(e,n),s(n)):-1,setSafeByIndex:(e,r,i=!1)=>{if(!l(r))return-1;if(e<0||e>=n.length)return-1;const o=t[2+r];t[2+r]=n[e];const c=s(r);return i&&(t[2+r]=o),c},getCharSafe:e=>c(e)?(e=>r(t[2+e]))(e):"",canSet:l,clone:()=>o(e),movesLeft:()=>t.reduce((e,n)=>e+(0===n),0),toArr:d,asString:()=>d().map(r).join(""),isEmpty:a,inBounds:c,checkWinning:s}}const c={defaultField:function(e){return o(i(e))},field:o,init:i,IMPOSSIBLE_MOVE:-1,NORMAL_MOVE:1,WINNING_MOVE:3,DRAW_MOVE:2}},373(e,n,t){t.d(n,{A:()=>l});var r=t(189),i=t(130),o=t(489);function c(e,n,t,r,i){const o=t;let c="";return i>=0&&i<r.length&&(c=r[i]),{isLastMove:e,isActive:n,text:o,color:c}}function s(e){return{clientUserIdx:e.colorOrder.indexOf(e.color),currentUserIdx:0,playersSize:e.playerLimit,activeCellIndex:-1,activeDigitIndex:-1,lastMove:-1,gameover:!0,round:0,moveCount:0,fieldArr:r.A.init(e.size),movesIdx:Array.from({length:e.size}).fill(-1)}}function a({currentUserIdx:e,clientUserIdx:n,playersSize:t,activeCellIndex:s,activeDigitIndex:a,lastMove:l,gameover:d,round:u,moveCount:f,fieldArr:g,movesIdx:A},I){let h=r.A.field(g);const v=(0,o.A)(console),p=(0,i.A)(["moveEnd","nextPlayer","gameover"]),m=p.on;const y=()=>{e=(e+1)%t},M=async function(t,i,o){if(!((e,n,t,r)=>!(n<0||n>=2)&&t===r&&h.canSet(e))(t,i,o,e))return{res:r.A.IMPOSSIBLE_MOVE,position:-1,digit:-1,playerId:e,clientId:o};const c=h.setSafeByIndex(i,t);if(c===r.A.IMPOSSIBLE_MOVE)return{res:c,position:-1,digit:-1,playerId:e,clientId:o};s=-1,a=-1,A[t]=o,l=t,++f;const u=e,g=n;return await p.call("moveEnd",{res:c,position:t,digit:i,playerId:u,clientId:g,moveCount:f}),c===r.A.NORMAL_MOVE&&(y(),await p.call("nextPlayer",{res:c,position:t,digit:i,playerId:u,clientId:g,moveCount:f})),c!==r.A.WINNING_MOVE&&c!==r.A.DRAW_MOVE||(d=!0,await p.call("gameover",{res:c,position:t,digit:i,playerId:u,clientId:g,moveCount:f})),{res:c,position:t,digit:i,playerId:u,clientId:g}},x=(e,n,t)=>v.add(()=>M(e,n,t)),S=h.size,C=()=>I.colorOrder[e],O=()=>{f=0,d=!1,s=-1,a=-1,l=-1,g=r.A.init(S()),A=Array.from({length:S()}).fill(-1),e=u%t,h=r.A.field(g)};return{on:m,size:S,tryMove:()=>x(s,a,e),setMoveAsync:x,enum1:()=>function*(){for(let e=0;e<h.size();++e)yield[e,c(l===e,s===e,h.getCharSafe(e),I.colorOrder,A[e])]}(),setActivePosition:function(t){n!==e||d||(s=h.canSet(t)?t:-1)},setActiveDigitIndex:function(t){n!==e||d||(a=t)},currentColor:C,isActiveDigit:e=>e===a,endMessage:t=>t===r.A.DRAW_MOVE?"Draw":e!==n?"You lose":"You win",endMessage2:e=>e===r.A.DRAW_MOVE?"Draw":C()+" player win",toJson:n=>({currentUserIdx:e,clientUserIdx:n,playersSize:t,activeCellIndex:s,activeDigitIndex:a,lastMove:l,gameover:d,fieldArr:h.toArr(),movesIdx:A,moveCount:f}),isGameOver:()=>d,isMyMove:()=>!d&&e===n,calcLastMoveRes:()=>{if(l<0)return r.A.IMPOSSIBLE_MOVE;return h.checkWinning(l)},getCurrentIndex:()=>e,setClientIndex:e=>{n=e},getClientIndex:()=>n,getPlayersSize:()=>t,setMyTurn:()=>{e=n},nextRound:()=>{++u,O()},resetRound:O}}const l={presenterFunc:a,defaultPresenter:s,presenterFuncDefault:function(e){return a(s(e),e)}}},975(e,n,t){function r(e){e.querySelector(".game").classList.remove("hidden");e.querySelector(".lobby").classList.add("hidden");const n=e.querySelector(".menu");n.querySelector(".control-panel")?.classList.add("absolute");e.querySelector(".log").innerHTML=""}t.d(n,{b:()=>r})}}]);