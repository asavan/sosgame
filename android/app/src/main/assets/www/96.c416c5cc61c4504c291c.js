"use strict";(self.webpackChunksosgame=self.webpackChunksosgame||[]).push([[96],{510:(e,n,t)=>{t.d(n,{A:()=>r});const r=function(e){return{message:e.onMessage}}},96:(e,n,t)=>{t.r(n),t.d(n,{default:()=>f});var r=t(379),o=t(571),i=t(940),s=t(373);var d=t(267),c=t(510),l=t(233);function a(e,n){const t={serverId:n};return e.sendRawAll("reconnect",t)}function u(e,n,t,r,o,i){const s=(0,c.A)(e);return n.registerHandler(s,o),function(e,n,t,r){for(const t of e.actionKeys())e.on(t,(e=>{let o=null;e&&null!==e.playerId&&(o=[r.idByInd(e.playerId)]),n.sendRawAll(t,e,o)}));return a(n,t)}(e,t,r,i)}function f(e,n,t,c){return new Promise(((f,I)=>{const A=d.A.getMyId(e,t,Math.random),v=d.A.setupLogger(n,t),g=(0,i.A)(A,v),x=(0,l.A)(v),m=function(e){const n=[];for(const[t]of Object.entries(e))n.push(t);let t=n.length;const o=t=>{const o=n[t];(0,r.vA)(o,"Bad Index");const i=e[o];return(0,r.vA)(i,"Empty client"),i},i=n=>{const t=e[n];return(0,r.vA)(t,`No id ${n} in clients`),t},s=(e,t)=>{const r=e.index,o=n[r];n[e.index]=n[t.index],e.index=t.index,n[t.index]=o,t.index=r};return{addClient:(o,i)=>{const s=e[o];s?s.name=i:(e[o]={index:t,name:i},n.push(o),++t),(0,r.vA)(t===n.length)},remove:o=>{const i=e[o];--t;const s=n[t];n[i.index]=s,n.pop(),e[s].index=i.index,e[o]=null,(0,r.vA)(t===n.length)},swapInd:(e,n)=>{const t=o(e),r=o(n);s(t,r)},swapById:(e,n)=>{const t=i(e),r=i(n);s(t,r)},indById:e=>i(e).index,idByInd:e=>n[e]}}({});m.addClient(A,A);const p=s.A.presenterFuncDefault(t),M=c(e,n,t,p);g.connect(g.getWebSocketUrl(t,e.location)).then((i=>{const s=function(e,n,t){const r=t.sh||e.location.href,i=new URL(r);return i.searchParams.set("mode","client"),(0,o.A)(i.toString(),n.querySelector(".qrcode"))}(e,n,t);M.on("started",(()=>{(0,r.k6)(s)})),M.on("winclosed",(()=>(p.nextRound(),M.redraw(),a(i,A)))),g.on("join",(e=>{m.addClient(e.from,e.from);const n=m.indById(e.from),t=m.indById(A),r=p.toJson(n),o={serverId:A,joinedInd:n,serverInd:t,presenter:r};i.sendRawTo("gameinit",o,e.from)})),u(M,g,i,A,x,m),f(M)})).catch((e=>{v.error(e),I(e)}))}))}},373:(e,n,t)=>{t.d(n,{A:()=>c});var r=t(189),o=t(746);function i(e,n,t,r,o){let i=t,s="";return o>=0&&o<r.length&&(s=r[o]),{isLastMove:e,isActive:n,text:i,color:s}}function s(e){return{clientUserIdx:e.colorOrder.indexOf(e.color),currentUserIdx:e.colorOrder.indexOf(e.color),playersSize:e.colorOrder.length,activeCellIndex:-1,activeDigitIndex:-1,lastMove:-1,gameover:!1,gamestarted:!1,round:0,fieldArr:r.A.init(e.size),movesIdx:Array(e.size).fill(-1)}}function d({currentUserIdx:e,clientUserIdx:n,playersSize:t,activeCellIndex:s,activeDigitIndex:d,lastMove:c,gameover:l,gamestarted:a,round:u,fieldArr:f,movesIdx:I},A){let v=r.A.field(f);const g=(0,o.A)(["firstmove","gameover"]);const x=function(o,i,u){if(!((e,n,t,r)=>!(n<0||n>=2)&&t==r&&v.canSet(e))(o,i,u,e))return{res:r.A.IMPOSSIBLE_MOVE,position:-1,digit:-1,playerId:e,clientId:u};const f=v.setSafeByIndex(i,o);if(f===r.A.IMPOSSIBLE_MOVE)return{res:f,position:-1,digit:-1,playerId:e,clientId:u};s=-1,d=-1,a||g.call("firstmove",{}),a=!0,I[o]=u,c=o;const x=e,m=n;return f===r.A.NORMAL_MOVE&&(e=(e+1)%t,"hotseat"===A.mode&&(n=e)),f!==r.A.WINNING_MOVE&&f!==r.A.DRAW_MOVE||(l=!0,g.call("gameover",f)),{res:f,position:o,digit:i,playerId:x,clientId:m}},m=v.size,p=()=>A.colorOrder[e];return{on:function(e,n){return g.on(e,n)},size:m,tryMove:function(){return x(s,d,e)},setMove:x,enum1:()=>function*(){for(let e=0;e<v.size();++e)yield[e,i(c===e,s===e,v.getCharSafe(e),A.colorOrder,I[e])]}(),setActivePosition:function(t){n!==e||l||(s=v.canSet(t)?t:-1)},setActiveDigitIndex:function(t){n!==e||l||(d=t)},currentColor:p,getActiveDigitIndex:()=>d,endMessage:t=>t===r.A.DRAW_MOVE?"Draw":e!==n?"You lose":"You win",endMessage2:e=>e===r.A.DRAW_MOVE?"Draw":p()+" player win",toJson:n=>({currentUserIdx:e,clientUserIdx:n,playersSize:t,activeCellIndex:s,activeDigitIndex:d,lastMove:c,gameover:l,fieldArr:v.toArr(),movesIdx:I}),isGameOver:()=>l,isMyMove:()=>!l&&e===n,calcLastMoveRes:()=>{if(c<0)return r.A.IMPOSSIBLE_MOVE;return v.checkWinning(c)},nextRound:()=>{++u,a=!1,l=!1,s=-1,d=-1,c=-1,l=!1,a=!1,f=r.A.init(A.size),I=Array(A.size).fill(-1),e=(n+u)%t,v=r.A.field(f)}}}const c={presenterFunc:d,defaultPresenter:s,presenterFuncDefault:function(e){return d(s(e),e)}}},233:(e,n,t)=>{function r(e){let n=Promise.resolve();return{add:t=>new Promise(((r,o)=>{n=n.then(t).then(r).catch((n=>{e.log(n),o(n)}))}))}}t.d(n,{A:()=>r})}}]);